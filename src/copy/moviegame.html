<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Grimmjow Vignette</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
  <link href="//fonts.googleapis.com/css?family=Play|VT323|Titillium+Web&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="//unpkg.com/augmented-ui/augmented.css">
  <link rel="stylesheet" type="text/css" href="css/main.min.css">
  <style>

    .movie-stage {
      width: 100%;
    }

    .movie-stage p {
      margin: 20px 0;
      font-size: 30px;
    }
  </style>
</head>

<body class="blue">
  <div class="container">
    <div class="screen-overlay"></div>
    <div class="interface">
      <div class="movie-stage card" augmented-ui="tr-clip-x r-clip bl-clip exe">
        <p class="movie-clue"></p>
        <button class="reveal">Click to reveal the answer</button>
        <p class="movie-answer"></p>

      </div>
    </div>
  </div>
  <!-- Scripts -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/typeit@6.1.1/dist/typeit.min.js" />
    </script>
  <script>
    let requestURL = 'js/moviegame.json';
    let request = new XMLHttpRequest();
    request.open('GET', requestURL);
    request.responseType = 'json';
    request.send();
    request.onload = function () {
      const movies = request.response;
      let movieCount = movies.length;
      let questionIndex = getRandomInt(movieCount);
      let movieQuestion = movies[questionIndex].clue;
      let movieAnswer = movies[questionIndex].answer;
      let questionText = document.getElementsByClassName('movie-clue');
      let questionAnswer = document.getElementsByClassName('movie-answer');
      questionFill(movieQuestion);
      answerFill(movieAnswer);
    }

    function getRandomInt(max) {
      return Math.floor(Math.random() * Math.floor(max));
    }

    function questionFill(movieQuestion) {
      let questionType = new TypeIt(".movie-clue", {
        strings: movieQuestion,
        speed: 50,
        waitUntilVisible: false,
        afterComplete: instance => {
          $(".movie-clue")
            .find(".ti-cursor")
            .addClass("is-hidden");
        }
      });
      questionType.go();
    }

    function answerFill(movieAnswer) {
      localStorage.setItem('movie-answer', movieAnswer);
    }

  document.addEventListener('click', function (event) {

    // If the clicked element doesn't have the right selector, bail
    if (!event.target.matches('.reveal')) return;
    event.preventDefault();
    let answerContent = localStorage.getItem('movie-answer');
    let answerType = new TypeIt(".movie-answer", {
      strings: answerContent,
      speed: 50,
      waitUntilVisible: false,
      afterComplete: instance => {
        $(".movie-answer")
          .find(".ti-cursor")
          .addClass("is-hidden");
      }
    });
    answerType.go();
  }, false);    

  </script>
</body>

</html>